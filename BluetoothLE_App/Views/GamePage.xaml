<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BluetoothLE_App.Views.GamePage"
             Title="{Binding YourState}"   xmlns:helpers="clr-namespace:BluetoothLE_App.Helpers"
               xmlns:viewModel="clr-namespace:BluetoothLE_App.ViewModel"
             x:Name="Page"   x:DataType="viewModel:GameViewModel"  
             xmlns:model="clr-namespace:BluetoothLE_App.Models"
             xmlns:controls="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls">
    <Grid
        RowDefinitions="*,auto,auto">

        <Label
            HorizontalOptions="Center"
            FontSize="Large"
            Margin="0,10"
            Text="{x:Static helpers:Constants+Texts.Await}"
            IsVisible="{Binding IsConnected}" />

        <Grid
            x:Name="Container"
            HeightRequest="{Binding Source={x:Reference Page}, Path=Width}"
            BindableLayout.ItemsSource="{Binding Fields}"
            RowDefinitions="*,auto,auto"
            ColumnDefinitions="*,auto,auto">

            <BindableLayout.ItemTemplate>

                <DataTemplate x:DataType="model:TicTacToeField">

                    <Border
                        Grid.Column="{Binding Y}"
                        Grid.Row="{Binding X}"
                        Content="{Binding Canvas}">

                        <Border.GestureRecognizers>

                            <TapGestureRecognizer
                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewModel:GameViewModel}},
                                                  Path=CanvasTapCommand}"
                                CommandParameter="{Binding .}" />
                        </Border.GestureRecognizers>
                    </Border>
                </DataTemplate>
            </BindableLayout.ItemTemplate>
        </Grid>

        <controls:SKCanvasView
            WidthRequest="{Binding Source={x:Reference Container}, Path=Width}"
            HeightRequest="{Binding Source={x:Reference Container}, Path=Height}"
            x:Name="WinnerLine"
            InputTransparent="True" />

        <Label
            Grid.Row="1"
            HorizontalOptions="Center"
            Margin="0,10">
            <Label.FormattedText>
                <FormattedString>
                    <Span
                        Text="{x:Static helpers:Constants+Texts.Turn}"
                        FontSize="Large" />
                    <Span
                        FontSize="Large"
                        Text="{Binding Turn}" />
                </FormattedString>
            </Label.FormattedText>
        </Label>

        <Label
            Grid.Row="2" TextColor="Black"
            HorizontalOptions="Center"
            FontSize="Large"
            Margin="0,10">
            <Label.FormattedText>
                <FormattedString>
                    <Span
                        Text="{Binding CurrentMove}"
                        FontSize="Large" >
                    </Span>
                    <Span
                        FontSize="Large"
                        Text="{x:Static helpers:Constants+Texts.Move}" />
                </FormattedString>
            </Label.FormattedText>
        </Label>
    </Grid>
</ContentPage>